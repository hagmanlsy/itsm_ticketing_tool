<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Ticket</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        function updatePriority() {
            const impact = document.getElementById('impact').value;
            const urgency = document.getElementById('urgency').value;

            let priority = 'Low';
            if ((impact === 'High' && urgency === 'High') ||
                (impact === 'High' && urgency === 'Medium') ||
                (impact === 'Medium' && urgency === 'High')) {
                priority = 'High';
            } else if ((impact === 'Medium' && urgency === 'Medium') ||
                       (impact === 'Medium' && urgency === 'Low') ||
                       (impact === 'Low' && urgency === 'High') ||
                       (impact === 'High' && urgency === 'Low')) {
                priority = 'Medium';
            }
            document.getElementById('priority').value = priority;
        }
    </script>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-center mb-4">Update Ticket</h2>
        <form method="post" class="card shadow p-4">
            <div class="mb-3">
                <label for="ticket_id" class="form-label">Ticket Number</label>
                <input type="text" class="form-control" id="ticket_id" name="ticket_id" value="{{ ticket.id }}" readonly>
            </div>

            <div class="mb-3">
                <label for="short_description" class="form-label">Short Description</label>
                <input type="text" class="form-control" id="short_description" name="short_description" value="{{ ticket.short_description }}" required>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description">{{ ticket.description }}</textarea>
            </div>
            <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category" name="category">
                    {% for option in categories %}
                        <option value="{{ option }}" {% if option == ticket.category %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="channel" class="form-label">Channel</label>
                <select class="form-select" id="channel" name="channel">
                    {% for option in channels %}
                        <option value="{{ option }}" {% if option == ticket.channel %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="requestor" class="form-label">Requestor</label>
                <select class="form-select" id="requestor" name="requestor">
                    {% for user in requestors %}
                        <option value="{{ user.username }}" {% if user.username == ticket.requestor %}selected{% endif %}>{{ user.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="assignee" class="form-label">Assignee</label>
                <select class="form-select" id="assignee" name="assignee">
                    {% for user in assignees %}
                        <option value="{{ user.username }}" {% if user.username == ticket.assignee %}selected{% endif %}>{{ user.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="impact" class="form-label">Impact</label>
                <select class="form-select" id="impact" name="impact" onchange="updatePriority()">
                    {% for option in impacts %}
                        <option value="{{ option }}" {% if option == ticket.impact %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="urgency" class="form-label">Urgency</label>
                <select class="form-select" id="urgency" name="urgency" onchange="updatePriority()">
                    {% for option in urgencies %}
                        <option value="{{ option }}" {% if option == ticket.urgency %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="priority" class="form-label">Priority</label>
                <input type="text" class="form-control" id="priority" name="priority" value="{{ ticket.priority }}" readonly>
            </div>
            <div class="mb-3">
                <label for="status" class="form-label">Status</label>
                <select class="form-select" id="status" name="status">
                    {% for option in statuses %}
                        <option value="{{ option }}" {% if option == ticket.status %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-success w-100">Update Ticket</button>
        </form>
        <div class="text-center mt-3">
            <a href="/tickets" class="btn btn-link">Back to Tickets</a>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
